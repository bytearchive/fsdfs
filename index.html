

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>fsdfs : f***ing simple distributed file system &mdash; fsdfs v0.1 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="fsdfs v0.1 documentation" href="#" />
    <link rel="next" title="API Reference" href="api.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api.html" title="API Reference"
             accesskey="N">next</a> |</li>
        <li><a href="#">fsdfs v0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="fsdfs-f-ing-simple-distributed-file-system">
<h1>fsdfs : f***ing simple distributed file system<a class="headerlink" href="#fsdfs-f-ing-simple-distributed-file-system" title="Permalink to this headline">¶</a></h1>
<div class="section" id="goals">
<h2>Goals<a class="headerlink" href="#goals" title="Permalink to this headline">¶</a></h2>
<p>fsdfs was originally developed at Jamendo.com to manage the distribution of millions of MP3/OGG files at
very low cost on commodity servers.</p>
<p>fsdfs aims to :</p>
<blockquote>
<ul class="simple">
<li>make a single virtual filesystem accessible from several servers</li>
<li>be fully distributed (no single point of failure)</li>
<li>automatically manage sharding/replication : files spread themselves among servers efficiently</li>
<li>make adding new servers a no-brainer : checkout code, set swarm password, ./fsdfsd.py and enjoy watching files replicate in :)</li>
<li>try to fill up its allowed disk quota to maximize redundancy</li>
<li>be extensible via simple python code</li>
<li>allow userland variables (like popularity) to boost a file&#8217;s replication/redundancy level</li>
<li>sit on top of any POSIX filesystem</li>
<li>have APIs to see on which servers a file is replicated, to be able to distribute client requests efficiently</li>
</ul>
</blockquote>
</div>
<div class="section" id="roadmap">
<h2>Roadmap<a class="headerlink" href="#roadmap" title="Permalink to this headline">¶</a></h2>
<p>For simplicity, fsdfs 1.0 will have a master/slaves design (slaves being readable even if the master is down).</p>
<p>fsdfs 2.0 will remove the need of a master server, possibly using a DHT network like Kademlia. Code for 1.0 will
already be structured to make its implementation easy.</p>
</div>
<div class="section" id="design-for-version-1-0">
<h2>Design for version 1.0<a class="headerlink" href="#design-for-version-1-0" title="Permalink to this headline">¶</a></h2>
<p>Each file has two important variables :</p>
<blockquote>
<ul class="simple">
<li>Its ideal replication count N. (N=3 by default, can be customized per-file by a user-defined python function)</li>
<li>Its current replication count K</li>
</ul>
</blockquote>
<p>The master has a list of all the servers with their status, which includes :</p>
<blockquote>
<ul class="simple">
<li>cpu/network load</li>
<li>list of all the files replicated on the server</li>
<li>free disk quota</li>
</ul>
</blockquote>
<p>The free disk quota will always tend to zero because each server tries to replicate as many files as it can.
Hence, max(K-N) is a more interesting number for a server, because it measures the extent of &#8220;over-replication&#8221;.
If max(K-N)&gt;0, some copies on the server are not strictly necessary and could be deleted.
If max(K-N)&lt;=0, every copy is needed and the server should be considered &#8220;full&#8221;.</p>
<p>The primary job of the master is to manage file replication, making sure target replications counts are
met or exceeded. In other words, it has to make min(K-N) accross all known files as high as it can.</p>
<p>The algorithm used is very simple :</p>
<ol class="arabic simple">
<li>select the file having min(K-N)</li>
<li>choose a server :</li>
</ol>
<blockquote>
<ul class="simple">
<li>not already having a copy of this file</li>
<li>not too loaded</li>
<li>with either free disk or a high max(K-N)</li>
</ul>
</blockquote>
<ol class="arabic simple" start="3">
<li>Have the file copied to this server (=&gt; K++)</li>
<li>GOTO 1</li>
</ol>
<p>min(K-N) across all files is a good measure of the health and general disk usage of the filesystem. min(K-N) should be
positive, ideally greater than 1 (in which case all the files would have one more copy than the target replication count)</p>
<p>min(K-N) will naturally decrease when adding new files. min(K-N) becoming &lt;1 or negative should be the signal that new servers are needed.</p>
</div>
<div class="section" id="how-to-test">
<h2>How to test<a class="headerlink" href="#how-to-test" title="Permalink to this headline">¶</a></h2>
<p>just run:</p>
<div class="highlight-python"><pre>python tests/basic.py
python tests/quota.py
python tests/persist.py</pre>
</div>
</div>
<div class="section" id="todo">
<h2>Todo<a class="headerlink" href="#todo" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Admin command (watch replication)</li>
<li>Test crashes/disconnects/...</li>
<li>Decide on how to manage file updates. Either:</li>
</ul>
<blockquote>
<ul class="simple">
<li>Nuke then insert</li>
<li>Append md5 to all filenames</li>
<li>Manage a file version system</li>
</ul>
</blockquote>
<ul class="simple">
<li>SQLite or other persistent filedb backend</li>
<li>Complete Sphinx documentation</li>
<li>Outreach to community</li>
</ul>
<blockquote>
<ul class="simple">
<li>setup twitter account / polish website</li>
<li>do public talks / pycon / ...</li>
</ul>
</blockquote>
<ul class="simple">
<li>performance tests</li>
<li>fsdfsd</li>
<li>FUSE layer?</li>
<li>Nagios plugin</li>
<li>Error catching everywhere</li>
<li>Solid python logging</li>
</ul>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>There are no packages yet, just clone our github repo!</p>
<div class="section" id="help-and-development">
<h3>Help and development<a class="headerlink" href="#help-and-development" title="Permalink to this headline">¶</a></h3>
<p>If you&#8217;d like to help out, you can fork the project
at <a class="reference external" href="http://github.com/sylvinus/fsdfs">http://github.com/sylvinus/fsdfs</a> and report any bugs
at <a class="reference external" href="http://github.com/sylvinus/fsdfs/issues">http://github.com/sylvinus/fsdfs/issues</a>.</p>
</div>
</div>
<div class="section" id="why-another-filesystem">
<h2>Why another filesystem?<a class="headerlink" href="#why-another-filesystem" title="Permalink to this headline">¶</a></h2>
<p>After looking at many open source projects like GlusterFS, XtreemFS, Tahoe, ... we found that they were extremely powerful,
but equally complicated to deploy. Most of them were also not supporting easy configuration of the replication for each file.
We found none that had explicitly the strategy to fill up each server with as many files as possible.</p>
<p>The project closest to the design we wanted was MogileFS, but we didn&#8217;t want to hack Perl code. So here we go! :)</p>
</div>
<div class="section" id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
</ul>
</div>
<div class="section" id="indices-and-tables">
<h3>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><em>Index</em></a></li>
<li><a class="reference internal" href="py-modindex.html"><em>Module Index</em></a></li>
<li><a class="reference internal" href="search.html"><em>Search Page</em></a></li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">fsdfs : f***ing simple distributed file system</a><ul>
<li><a class="reference internal" href="#goals">Goals</a></li>
<li><a class="reference internal" href="#roadmap">Roadmap</a></li>
<li><a class="reference internal" href="#design-for-version-1-0">Design for version 1.0</a></li>
<li><a class="reference internal" href="#how-to-test">How to test</a></li>
<li><a class="reference internal" href="#todo">Todo</a></li>
<li><a class="reference internal" href="#installation">Installation</a><ul>
<li><a class="reference internal" href="#help-and-development">Help and development</a></li>
</ul>
</li>
<li><a class="reference internal" href="#why-another-filesystem">Why another filesystem?</a></li>
<li><a class="reference internal" href="#documentation">Documentation</a><ul>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Next topic</h4>
  <p class="topless"><a href="api.html"
                        title="next chapter">API Reference</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api.html" title="API Reference"
             >next</a> |</li>
        <li><a href="#">fsdfs v0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, Sylvain Zimmer &amp; contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>
  </body>
</html>